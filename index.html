<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÙØ§ÛŒÙ„â€ŒÙ‡Ø§</title>

  <style>
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --muted:#9aa6c2;
      --text:#e9eeff;
      --border:rgba(255,255,255,.08);
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --primary:#7c5cff;
      --primary2:#5bdbff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: radial-gradient(1200px 700px at 20% 0%, rgba(124,92,255,.25), transparent 60%),
                  radial-gradient(1000px 600px at 90% 20%, rgba(91,219,255,.18), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    code{background:rgba(255,255,255,.06); padding:.1rem .35rem; border-radius:.4rem}
    .topbar{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(10px);
      background: rgba(11,16,32,.55);
      border-bottom:1px solid var(--border);
      display:flex; justify-content:space-between; align-items:center;
      padding:14px 18px;
    }
    .brand{display:flex; gap:12px; align-items:center}
    .logo{
      width:42px; height:42px; border-radius:14px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      color:#071021; font-weight:800;
    }
    .title{font-weight:800}
    .subtitle{font-size:.9rem; color:var(--muted)}
    .actions{display:flex; gap:10px}
    .container{
      max-width:1100px;
      margin:0 auto;
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    .card{
      background: rgba(18,26,51,.78);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:16px;
    }
    .cardHead{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      margin-bottom:8px;
    }
    .muted{color:var(--muted); margin:.3rem 0 0}
    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:10px;
      margin-top:10px;
    }
    @media (max-width: 900px){ .grid{grid-template-columns:1fr} }
    .field label{display:block; font-size:.92rem; margin-bottom:6px; color:#cfd7ff}
    .field input, .field textarea{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      color:var(--text);
      outline:none;
    }
    .field input:focus, .field textarea:focus{
      border-color: rgba(124,92,255,.55);
      box-shadow: 0 0 0 3px rgba(124,92,255,.18);
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .btn{
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
    }
    .btn:hover{background: rgba(255,255,255,.09)}
    .btn-primary{
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(91,219,255,.75));
      border: none;
      color:#071021;
      font-weight:800;
    }
    .btn-ghost{ background: transparent; }
    .split{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:16px;
    }
    @media (max-width: 900px){ .split{grid-template-columns:1fr} }
    .list{display:flex; flex-direction:column; gap:10px; margin-top:10px}
    .item{
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      border-radius:16px;
      padding:12px;
      display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
    }
    .item .meta{display:flex; flex-direction:column; gap:4px}
    .item .name{font-weight:800}
    .item .desc{color:var(--muted); font-size:.92rem; line-height:1.35}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      color:#cfd7ff;
      font-size:.82rem;
      width:fit-content;
    }
    .kv{display:flex; gap:10px; flex-wrap:wrap; margin-top:6px}
    .kv span{color:var(--muted); font-size:.86rem}
    .itemActions{display:flex; gap:8px}
    .iconBtn{
      width:38px; height:38px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
    }
    .iconBtn:hover{background: rgba(255,255,255,.1)}
    .tabs{display:flex; gap:8px; margin-top:10px}
    .tab{
      padding:8px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.05);
      color:var(--text);
      cursor:pointer;
    }
    .tab.active{
      background: rgba(124,92,255,.22);
      border-color: rgba(124,92,255,.45);
    }
    .preview{margin-top:10px}
    .code{
      margin:0;
      white-space: pre-wrap;
      word-break: break-word;
      background: rgba(0,0,0,.28);
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      min-height:160px;
    }
    .modal{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:grid; place-items:center;
      padding:16px;
      z-index:50;
    }
    .modalCard{
      width:min(680px, 100%);
      background: rgba(18,26,51,.98);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:14px;
    }
    .modalHead{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px; padding-bottom:8px;
      border-bottom:1px solid var(--border);
    }
    .modalFoot{
      display:flex; justify-content:flex-end; gap:10px;
      margin-top:12px;
    }
    .status{margin-top:10px; color:var(--muted)}
    .linksBox{
      margin-top:10px;
      padding:10px 12px;
      border-radius:16px;
      background: rgba(0,0,0,.25);
      border:1px solid var(--border);
    }
    .hidden{display:none !important}
  </style>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">CP</div>
      <div>
        <div class="title">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÙØ§ÛŒÙ„â€ŒÙ‡Ø§</div>
        <div class="subtitle">ÛŒÚ© ÙØ§ÛŒÙ„ HTML â€” Ø¨Ø¯ÙˆÙ† Ø¨Ú©â€ŒØ§Ù†Ø¯</div>
      </div>
    </div>
    <div class="actions">
      <button id="btnExport" class="btn">Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø±ÙØªÙ†</button>
      <button id="btnImport" class="btn btn-ghost">ÙˆØ±ÙˆØ¯ Ø¯Ø§Ø¯Ù‡</button>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h2>ØªÙ†Ø¸ÛŒÙ…Ø§Øª GitHub (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</h2>
      <p class="muted">
        Ø§Ú¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØŒ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ â€œØ§Ù†ØªØ´Ø§Ø± Ø¯Ø± GitHubâ€ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ <code>servers.json</code> Ùˆ <code>sub.txt</code> Ø¯Ø§Ø®Ù„ Ø±ÛŒÙ¾Ùˆ Ø¢Ù¾Ø¯ÛŒØª Ù…ÛŒâ€ŒØ´Ù†
        Ùˆ Ù„ÛŒÙ†Ú© Ø®Ø§Ù… (raw) Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ù‡â€ŒØ±ÙˆØ² Ù…ÛŒâ€ŒÙ…ÙˆÙ†Ù‡.
      </p>

      <div class="grid">
        <div class="field">
          <label>Owner (Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ GitHub)</label>
          <input id="ghOwner" placeholder="Ù…Ø«Ù„Ø§Ù‹ amirhossein" />
        </div>
        <div class="field">
          <label>Repo (Ø§Ø³Ù… Ø±ÛŒÙ¾Ùˆ)</label>
          <input id="ghRepo" placeholder="Ù…Ø«Ù„Ø§Ù‹ config-panel" />
        </div>
        <div class="field">
          <label>Branch</label>
          <input id="ghBranch" placeholder="main" />
        </div>
        <div class="field">
          <label>Path servers.json</label>
          <input id="ghPathServers" placeholder="servers.json" />
        </div>
        <div class="field">
          <label>Path sub.txt</label>
          <input id="ghPathSub" placeholder="sub.txt" />
        </div>
        <div class="field">
          <label>GitHub Token (PAT)</label>
          <input id="ghToken" placeholder="ghp_..." type="password" />
          <small class="muted">ØªÙˆÚ©Ù† ÙÙ‚Ø· Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (localStorage).</small>
        </div>
      </div>

      <div class="row">
        <button id="btnPublish" class="btn btn-primary">Ø§Ù†ØªØ´Ø§Ø± Ø¯Ø± GitHub</button>
        <button id="btnShowLinks" class="btn btn-ghost">Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</button>
      </div>

      <div id="linksBox" class="linksBox hidden"></div>
      <div id="publishStatus" class="status"></div>
    </section>

    <section class="split">
      <section class="card">
        <div class="cardHead">
          <h2>Ø³Ø±ÙˆØ±Ù‡Ø§</h2>
          <button id="btnAddServer" class="btn">+ Ø§ÙØ²ÙˆØ¯Ù†</button>
        </div>
        <div id="serversList" class="list"></div>
      </section>

      <section class="card">
        <div class="cardHead">
          <h2>Ù¾Ø±ÙˆÙØ§ÛŒÙ„â€ŒÙ‡Ø§</h2>
          <button id="btnAddProfile" class="btn">+ Ø§ÙØ²ÙˆØ¯Ù†</button>
        </div>
        <p class="muted">Ù‡Ø± Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÛŒÚ© Ù…ØªÙ†/Ù„ÛŒÙ†Ú© Ø§Ø³Øª Ú©Ù‡ Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ <code>sub.txt</code> Ø®Ø· Ø¨Ù‡ Ø®Ø· Ù†ÙˆØ´ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
        <div id="profilesList" class="list"></div>
      </section>
    </section>

    <section class="card">
      <h2>Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ Ø®Ø±ÙˆØ¬ÛŒâ€ŒÙ‡Ø§</h2>
      <div class="tabs">
        <button class="tab active" data-tab="servers">servers.json</button>
        <button class="tab" data-tab="sub">sub.txt</button>
      </div>

      <div class="preview">
        <pre id="preview" class="code"></pre>
      </div>

      <div class="row">
        <button id="btnDownloadServers" class="btn">Ø¯Ø§Ù†Ù„ÙˆØ¯ servers.json</button>
        <button id="btnDownloadSub" class="btn btn-ghost">Ø¯Ø§Ù†Ù„ÙˆØ¯ sub.txt</button>
      </div>
    </section>
  </main>

  <!-- Modal -->
  <div id="modal" class="modal hidden">
    <div class="modalCard">
      <div class="modalHead">
        <h3 id="modalTitle"></h3>
        <button id="modalClose" class="iconBtn" aria-label="Close">âœ•</button>
      </div>
      <div id="modalBody"></div>
      <div class="modalFoot">
        <button id="modalCancel" class="btn btn-ghost">Ø§Ù†ØµØ±Ø§Ù</button>
        <button id="modalSave" class="btn btn-primary">Ø°Ø®ÛŒØ±Ù‡</button>
      </div>
    </div>
  </div>

  <input id="fileInput" type="file" accept=".json" class="hidden" />
    
    function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state, null, 2)); }
    let state = loadState();

    /* ===========================
       Helpers
    =========================== */
    const $ = (sel) => document.querySelector(sel);
    const el = (tag, cls) => {
      const e = document.createElement(tag);
      if(cls) e.className = cls;
      return e;
    };

    function escapeHtml(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function downloadText(filename, content, type="text/plain"){
      const blob = new Blob([content], { type });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    /* ===========================
       UI: Modal
    =========================== */
    const modal = $("#modal");
    const modalTitle = $("#modalTitle");
    const modalBody = $("#modalBody");
    const modalClose = $("#modalClose");
    const modalCancel = $("#modalCancel");
    const modalSave = $("#modalSave");
    let modalOnSave = null;

    function openModal(title, bodyNode, onSave){
      modalTitle.textContent = title;
      modalBody.innerHTML = "";
      modalBody.appendChild(bodyNode);
      modalOnSave = onSave;
      modal.classList.remove("hidden");
    }
    function closeModal(){
      modal.classList.add("hidden");
      modalOnSave = null;
    }
    modalClose.onclick = closeModal;
    modalCancel.onclick = closeModal;
    modalSave.onclick = () => { if(typeof modalOnSave === "function") modalOnSave(); };

    /* ===========================
       Render
    =========================== */
    const serversList = $("#serversList");
    const profilesList = $("#profilesList");
    const preview = $("#preview");
    let activeTab = "servers";

    function render(){
      $("#ghOwner").value = state.github.owner;
      $("#ghRepo").value = state.github.repo;
      $("#ghBranch").value = state.github.branch;
      $("#ghPathServers").value = state.github.pathServers;
      $("#ghPathSub").value = state.github.pathSub;
      $("#ghToken").value = state.github.token;

      serversList.innerHTML = "";
      state.servers.forEach(s => {
        const item = el("div", "item");
        const meta = el("div", "meta");
        const name = el("div", "name");
        name.textContent = s.name + (s.enabled ? "" : " (Ø®Ø§Ù…ÙˆØ´)");
        const desc = el("div", "desc");
        desc.innerHTML = `
          <div class="badge">${s.enabled ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„"}</div>
          <div class="kv">
            <span>Host: ${escapeHtml(s.host)}</span>
            <span>Port: ${escapeHtml(s.port)}</span>
          </div>
          <div class="muted">${escapeHtml(s.note || "")}</div>
        `;
        meta.appendChild(name);
        meta.appendChild(desc);

        const actions = el("div", "itemActions");
        const btnEdit = el("button", "iconBtn");
        btnEdit.textContent = "âœ";
        btnEdit.title = "ÙˆÛŒØ±Ø§ÛŒØ´";
        btnEdit.onclick = () => openServerForm(s);

        const btnToggle = el("button", "iconBtn");
        btnToggle.textContent = s.enabled ? "â»" : "â½";
        btnToggle.title = s.enabled ? "ØºÛŒØ±ÙØ¹Ø§Ù„" : "ÙØ¹Ø§Ù„";
        btnToggle.onclick = () => { s.enabled = !s.enabled; saveState(); render(); };

        const btnDel = el("button", "iconBtn");
        btnDel.textContent = "ğŸ—‘";
        btnDel.title = "Ø­Ø°Ù";
        btnDel.onclick = () => {
          state.servers = state.servers.filter(x => x.id !== s.id);
          saveState(); render();
        };

        actions.append(btnEdit, btnToggle, btnDel);
        item.append(meta, actions);
        serversList.appendChild(item);
      });

      profilesList.innerHTML = "";
      state.profiles.forEach(p => {
        const item = el("div", "item");
        const meta = el("div", "meta");
        const name = el("div", "name");
        name.textContent = p.name + (p.enabled ? "" : " (Ø®Ø§Ù…ÙˆØ´)");
        const desc = el("div", "desc");
        desc.innerHTML = `
          <div class="badge">${p.enabled ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„"}</div>
          <div class="muted">${escapeHtml(p.note || "")}</div>
          <div class="kv"><span>${escapeHtml(p.content)}</span></div>
        `;
        meta.append(name, desc);

        const actions = el("div", "itemActions");
        const btnEdit = el("button", "iconBtn");
        btnEdit.textContent = "âœ";
        btnEdit.title = "ÙˆÛŒØ±Ø§ÛŒØ´";
        btnEdit.onclick = () => openProfileForm(p);

        const btnToggle = el("button", "iconBtn");
        btnToggle.textContent = p.enabled ? "â»" : "â½";
        btnToggle.title = p.enabled ? "ØºÛŒØ±ÙØ¹Ø§Ù„" : "ÙØ¹Ø§Ù„";
        btnToggle.onclick = () => { p.enabled = !p.enabled; saveState(); render(); };

        const btnDel = el("button", "iconBtn");
        btnDel.textContent = "ğŸ—‘";
        btnDel.title = "Ø­Ø°Ù";
        btnDel.onclick = () => {
          state.profiles = state.profiles.filter(x => x.id !== p.id);
          saveState(); render();
        };

        actions.append(btnEdit, btnToggle, btnDel);
        item.append(meta, actions);
        profilesList.appendChild(item);
      });

      preview.textContent = activeTab === "servers" ? buildServersJson() : buildSubTxt();
      document.querySelectorAll(".tab").forEach(t => t.classList.toggle("active", t.dataset.tab === activeTab));
    }

    function buildServersJson(){
      const payload = {
        updatedAt: new Date().toISOString(),
        servers: state.servers.filter(s => s.enabled).map(({id, ...rest}) => rest),
        profiles: state.profiles.filter(p => p.enabled).map(({id, ...rest}) => rest),
      };
      return JSON.stringify(payload, null, 2);
    }

    function buildSubTxt(){
      return state.profiles
        .filter(p => p.enabled)
        .map(p => p.content.trim())
        .filter(Boolean)
        .join("\\n") + "\\n";
    }

    /* ===========================
       Forms
    =========================== */
    function openServerForm(existing){
      const isEdit = !!existing;
      const wrap = el("div");
      wrap.innerHTML = `
        <div class="grid">
          <div class="field">
            <label>Ù†Ø§Ù…</label>
            <input id="f_name" placeholder="Ù…Ø«Ù„Ø§Ù‹ DE-1" value="${escapeHtml(existing?.name || "")}">
          </div>
          <div class="field">
            <label>Host</label>
            <input id="f_host" placeholder="example.com" value="${escapeHtml(existing?.host || "")}">
          </div>
          <div class="field">
            <label>Port</label>
            <input id="f_port" type="number" placeholder="443" value="${escapeHtml(existing?.port ?? 443)}">
          </div>
          <div class="field" style="grid-column:1/-1">
            <label>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</label>
            <input id="f_note" placeholder="Ø§Ø®ØªÛŒØ§Ø±ÛŒ" value="${escapeHtml(existing?.note || "")}">
          </div>
          <div class="field" style="grid-column:1/-1">
            <label>ÙØ¹Ø§Ù„</label>
            <input id="f_enabled" type="checkbox" ${(existing?.enabled ?? true) ? "checked" : ""}>
          </div>
        </div>
      `;
      openModal(isEdit ? "ÙˆÛŒØ±Ø§ÛŒØ´ Ø³Ø±ÙˆØ±" : "Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø±ÙˆØ±", wrap, () => {
        const name = $("#f_name").value.trim();
        const host = $("#f_host").value.trim();
        const port = Number($("#f_port").value || 0);
        const note = $("#f_note").value.trim();
        const enabled = $("#f_enabled").checked;

        if(!name || !host || !port){ alert("Ù†Ø§Ù…ØŒ Host Ùˆ Port Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª."); return; }

        if(isEdit){
          existing.name = name; existing.host = host; existing.port = port;
          existing.note = note; existing.enabled = enabled;
        }else{
          state.servers.unshift({ id: crypto.randomUUID(), name, host, port, note, enabled });
        }
        saveState(); render(); closeModal();
      });
    }

    function openProfileForm(existing){
      const isEdit = !!existing;
      const wrap = el("div");
      wrap.innerHTML = `
        <div class="grid">
          <div class="field">
            <label>Ù†Ø§Ù…</label>
            <input id="p_enabled" type="checkbox" ${(existing?.enabled ?? true) ? "checked" : ""}>
          </div>
        </div>
      `;
      openModal(isEdit ? "ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„" : "Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø±ÙˆÙØ§ÛŒÙ„", wrap, () => {
        const name = $("#p_name").value.trim();
        const content = $("#p_content").value.trim();
        const note = $("#p_note").value.trim();
        const enabled = $("#p_enabled").checked;

        if(!name || !content){ alert("Ù†Ø§Ù… Ùˆ Ù…ØªÙ†/Ù„ÛŒÙ†Ú© Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª."); return; }

        if(isEdit){
          existing.name = name; existing.content = content;
          existing.note = note; existing.enabled = enabled;
        }else{
          state.profiles.unshift({ id: crypto.randomUUID(), name, content, note, enabled });
        }
        saveState(); render(); closeModal();
      });
    }

    /* ===========================
       GitHub Publish (No Backend)
    =========================== */
    async function ghUpsertFile({owner, repo, branch, path, token, content, commitMessage}){
      const apiBase = `https://api.github.com/repos/${owner}/${repo}/contents/${encodeURIComponent(path).replaceAll("%2F","/")}`;

      const getRes = await fetch(`${apiBase}?ref=${encodeURIComponent(branch)}`, {
        headers: { "Authorization": `Bearer ${token}`, "Accept": "application/vnd.github+json" }
      });

      let sha = null;
      if(getRes.status === 200){
        const data = await getRes.json();
        sha = data.sha;
      }else if(getRes.status === 404){
        sha = null;
      }else{
        const txt = await getRes.text();
        throw new Error(`GitHub GET failed: ${getRes.status} ${txt}`);
      }

      const b64 = btoa(unescape(encodeURIComponent(content)));
      const body = { message: commitMessage, content: b64, branch };
      if(sha) body.sha = sha;

      const putRes = await fetch(apiBase, {
        method: "PUT",
        headers: {
          "Authorization": `Bearer ${token}`,
          "Accept": "application/vnd.github+json",
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });

      if(!putRes.ok){
        const txt = await putRes.text();
        throw new Error(`GitHub PUT failed: ${putRes.status} ${txt}`);
      }
      return putRes.json();
    }

    function buildUserLinks(){
      const { owner, repo, branch, pathServers, pathSub } = state.github;
      const rawBase = `https://raw.githubusercontent.com/${owner}/${repo}/${branch}`;
      return { serversJson: `${rawBase}/${pathServers}`, subTxt: `${rawBase}/${pathSub}` };
    }

    /* ===========================
       Events
    =========================== */
    $("#btnAddServer").onclick = () => openServerForm(null);
    $("#btnAddProfile").onclick = () => openProfileForm(null);

    document.querySelectorAll(".tab").forEach(t => {
      t.onclick = () => { activeTab = t.dataset.tab; render(); };
    });

    $("#btnDownloadServers").onclick = () => downloadText("servers.json", buildServersJson(), "application/json");
    $("#btnDownloadSub").onclick = () => downloadText("sub.txt", buildSubTxt(), "text/plain");

    $("#btnExport").onclick = () => downloadText("panel-export.json", JSON.stringify(state, null, 2), "application/json");

    $("#btnImport").onclick = () => $("#fileInput").click();
    $("#fileInput").addEventListener("change", async (e) => {
      const file = e.target.files?.[0];
      if(!file) return;
      try{
        const txt = await file.text();
        const data = JSON.parse(txt);
        state = {
          ...structuredClone(defaultState),
          ...data,
          github: { ...structuredClone(defaultState.github), ...(data.github || {}) }
        };
        saveState(); render(); alert("Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ÙˆØ§Ø±Ø¯ Ø´Ø¯.");
      }catch{
        alert("ÙØ§ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.");
      }finally{
        e.target.value = "";
      }
    });

    ["ghOwner","ghRepo","ghBranch","ghPathServers","ghPathSub","ghToken"].forEach(id => {
      $("#"+id).addEventListener("input", () => {
        state.github.owner = $("#ghOwner").value.trim();
        state.github.repo = $("#ghRepo").value.trim();
        state.github.branch = $("#ghBranch").value.trim() || "main";
        state.github.pathServers = $("#ghPathServers").value.trim() || "servers.json";
        state.github.pathSub = $("#ghPathSub").value.trim() || "sub.txt";
        state.github.token = $("#ghToken").value.trim();
        saveState();
<script>
/* ===========================
   Polyfills (Ø¨Ø±Ø§ÛŒ Ø¨Ø¹Ø¶ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§)
=========================== */
if (typeof structuredClone !== "function") {
  window.structuredClone = (obj) => JSON.parse(JSON.stringify(obj));
}
if (!String.prototype.replaceAll) {
  String.prototype.replaceAll = function (search, replacement) {
    return this.split(search).join(replacement);
  };
}
if (!crypto.randomUUID) {
  crypto.randomUUID = function () {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (c) {
      const r = crypto.getRandomValues(new Uint8Array(1))[0] & 15;
      const v = c === "x" ? r : (r & 0x3) | 0x8;
      return v.toString(16);
    });
  };
}

/* ===========================
   Helpers
=========================== */
const $ = (sel) => document.querySelector(sel);
const el = (tag, cls) => {
  const e = document.createElement(tag);
  if (cls) e.className = cls;
  return e;
};

function escapeHtml(s){
  return (s ?? "").toString()
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function downloadText(filename, content, type="text/plain"){
  const blob = new Blob([content], { type });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

function b64EncodeUtf8(str){
  // base64 safe for utf-8
  return btoa(unescape(encodeURIComponent(str)));
}

/* ===========================
   State
=========================== */
const LS_KEY = "panel_config_state_v2";

const defaultState = {
  github: {
    owner: "",
    repo: "",
    branch: "main",
    pathSub: "sub.txt",
    token: ""
  },
  servers: [
    { id: crypto.randomUUID(), name: "Server-1", host: "example.com", port: 443, note: "Ù†Ù…ÙˆÙ†Ù‡", enabled: true }
  ],
  profiles: [
    { id: crypto.randomUUID(), name: "Profile-1", content: "sample-line-1", note: "Ù‡Ø± Ø®Ø· = ÛŒÚ© Ø¢ÛŒØªÙ…", enabled: true }
  ]
};

let state = loadState();

function loadState(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(!raw) return structuredClone(defaultState);
    const data = JSON.parse(raw);
    return {
      ...structuredClone(defaultState),
      ...data,
      github: { ...structuredClone(defaultState.github), ...(data.github || {}) },
      servers: Array.isArray(data.servers) ? data.servers : structuredClone(defaultState.servers),
      profiles: Array.isArray(data.profiles) ? data.profiles : structuredClone(defaultState.profiles),
    };
  }catch{
    return structuredClone(defaultState);
  }
}

function saveState(){
  localStorage.setItem(LS_KEY, JSON.stringify(state, null, 2));
}

/* ===========================
   Build Outputs
=========================== */
function buildSubTxt(){
  // Ù‡Ø± Ù¾Ø±ÙˆÙØ§ÛŒÙ„ = ÛŒÚ© Ø®Ø· (Ù…ØªÙ† Ø¯Ù„Ø®ÙˆØ§Ù‡)
  return state.profiles
    .filter(p => p.enabled)
    .map(p => (p.content || "").trim())
    .filter(Boolean)
    .join("\n") + "\n";
}

function buildExportJson(){
  // Ø®Ø±ÙˆØ¬ÛŒ Ù…Ø®ØµÙˆØµ Ù¾Ù†Ù„ Ø¨Ø±Ø§ÛŒ Import Ø¯ÙˆØ¨Ø§Ø±Ù‡
  return JSON.stringify(state, null, 2);
}

function buildRawSubLink(){
  const { owner, repo, branch, pathSub } = state.github;
  return `https://raw.githubusercontent.com/${owner}/${repo}/${branch}/${pathSub}`;
}

/* ===========================
   Modal
=========================== */
const modal = $("#modal");
const modalTitle = $("#modalTitle");
const modalBody = $("#modalBody");
const modalClose = $("#modalClose");
const modalCancel = $("#modalCancel");
const modalSave = $("#modalSave");

let modalOnSave = null;

function openModal(title, bodyNode, onSave){
  modalTitle.textContent = title;
  modalBody.innerHTML = "";
  modalBody.appendChild(bodyNode);
  modalOnSave = onSave;
  modal.classList.remove("hidden");
}
function closeModal(){
  modal.classList.add("hidden");
  modalOnSave = null;
}

if (modalClose) modalClose.onclick = closeModal;
if (modalCancel) modalCancel.onclick = closeModal;
if (modalSave) modalSave.onclick = () => { if (typeof modalOnSave === "function") modalOnSave(); };

/* ===========================
   Render
=========================== */
const serversList = $("#serversList");
const profilesList = $("#profilesList");
const preview = $("#preview");

let activeTab = "sub"; // ÙÙ‚Ø· sub.txt Ø±Ùˆ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡

function render(){
  // github inputs
  const ghOwner = $("#ghOwner"), ghRepo = $("#ghRepo"), ghBranch = $("#ghBranch"), ghPathSub = $("#ghPathSub"), ghToken = $("#ghToken");
  if (ghOwner) ghOwner.value = state.github.owner;
  if (ghRepo) ghRepo.value = state.github.repo;
  if (ghBranch) ghBranch.value = state.github.branch;
  if (ghPathSub) ghPathSub.value = state.github.pathSub;
  if (ghToken) ghToken.value = state.github.token;

  // servers
  if (serversList){
    serversList.innerHTML = "";
    state.servers.forEach(s => {
      const item = el("div","item");
      const meta = el("div","meta");
      const name = el("div","name");
      name.textContent = s.name + (s.enabled ? "" : " (Ø®Ø§Ù…ÙˆØ´)");
      const desc = el("div","desc");
      desc.innerHTML = `
        <div class="badge">${s.enabled ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„"}</div>
        <div class="kv">
          <span>Host: ${escapeHtml(s.host)}</span>
          <span>Port: ${escapeHtml(s.port)}</span>
        </div>
        <div class="muted">${escapeHtml(s.note || "")}</div>
      `;
      meta.append(name, desc);

      const actions = el("div","itemActions");

      const btnEdit = el("button","iconBtn");
      btnEdit.textContent = "âœ";
      btnEdit.title = "ÙˆÛŒØ±Ø§ÛŒØ´";
      btnEdit.onclick = () => openServerForm(s);

      const btnToggle = el("button","iconBtn");
      btnToggle.textContent = s.enabled ? "â»" : "â½";
      btnToggle.title = s.enabled ? "ØºÛŒØ±ÙØ¹Ø§Ù„" : "ÙØ¹Ø§Ù„";
      btnToggle.onclick = () => { s.enabled = !s.enabled; saveState(); render(); };

      const btnDel = el("button","iconBtn");
      btnDel.textContent = "ğŸ—‘";
      btnDel.title = "Ø­Ø°Ù";
      btnDel.onclick = () => {
        state.servers = state.servers.filter(x => x.id !== s.id);
        saveState(); render();
      };

      actions.append(btnEdit, btnToggle, btnDel);
      item.append(meta, actions);
      serversList.appendChild(item);
    });
  }

  // profiles
  if (profilesList){
    profilesList.innerHTML = "";
    state.profiles.forEach(p => {
      const item = el("div","item");
      const meta = el("div","meta");
      const name = el("div","name");
      name.textContent = p.name + (p.enabled ? "" : " (Ø®Ø§Ù…ÙˆØ´)");

      const desc = el("div","desc");
      desc.innerHTML = `
        <div class="badge">${p.enabled ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„"}</div>
        <div class="muted">${escapeHtml(p.note || "")}</div>
        <div class="kv"><span>${escapeHtml(p.content)}</span></div>
      `;
      meta.append(name, desc);

      const actions = el("div","itemActions");

      const btnEdit = el("button","iconBtn");
      btnEdit.textContent = "âœ";
      btnEdit.title = "ÙˆÛŒØ±Ø§ÛŒØ´";
      btnEdit.onclick = () => openProfileForm(p);

      const btnToggle = el("button","iconBtn");
      btnToggle.textContent = p.enabled ? "â»" : "â½";
      btnToggle.title = p.enabled ? "ØºÛŒØ±ÙØ¹Ø§Ù„" : "ÙØ¹Ø§Ù„";
      btnToggle.onclick = () => { p.enabled = !p.enabled; saveState(); render(); };

      const btnDel = el("button","iconBtn");
      btnDel.textContent = "ğŸ—‘";
      btnDel.title = "Ø­Ø°Ù";
      btnDel.onclick = () => {
        state.profiles = state.profiles.filter(x => x.id !== p.id);
        saveState(); render();
      };

      actions.append(btnEdit, btnToggle, btnDel);
      item.append(meta, actions);
      profilesList.appendChild(item);
    });
  }

  // preview
  if (preview){
    preview.textContent = buildSubTxt();
  }

  // tabs
  document.querySelectorAll(".tab").forEach(t => {
    t.classList.toggle("active", t.dataset.tab === activeTab);
  });
}

/* ===========================
   Forms
=========================== */
function openServerForm(existing){
  const isEdit = !!existing;
  const wrap = el("div");

  wrap.innerHTML = `
    <div class="grid">
      <div class="field">
        <label>Ù†Ø§Ù…</label>
        <input id="f_name" placeholder="Ù…Ø«Ù„Ø§Ù‹ DE-1" value="${escapeHtml(existing?.name || "")}">
      </div>
      <div class="field">
        <label>Host</label>
        <input id="f_host" placeholder="example.com" value="${escapeHtml(existing?.host || "")}">
      </div>
      <div class="field">
        <label>Port</label>
        <input id="f_port" type="number" placeholder="443" value="${escapeHtml(existing?.port ?? 443)}">
      </div>
      <div class="field" style="grid-column:1/-1">
        <label>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</label>
        <input id="f_note" placeholder="Ø§Ø®ØªÛŒØ§Ø±ÛŒ" value="${escapeHtml(existing?.note || "")}">
      </div>
      <div class="field" style="grid-column:1/-1">
        <label>ÙØ¹Ø§Ù„</label>
        <input id="f_enabled" type="checkbox" ${(existing?.enabled ?? true) ? "checked" : ""}>
      </div>
    </div>
  `;

  openModal(isEdit ? "ÙˆÛŒØ±Ø§ÛŒØ´ Ø³Ø±ÙˆØ±" : "Ø§ÙØ²ÙˆØ¯Ù† Ø³Ø±ÙˆØ±", wrap, () => {
    const name = $("#f_name").value.trim();
    const host = $("#f_host").value.trim();
    const port = Number($("#f_port").value || 0);
    const note = $("#f_note").value.trim();
    const enabled = $("#f_enabled").checked;

    if(!name || !host || !port){
      alert("Ù†Ø§Ù…ØŒ Host Ùˆ Port Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª.");
      return;
    }

    if(isEdit){
      existing.name = name;
      existing.host = host;
      existing.port = port;
      existing.note = note;
      existing.enabled = enabled;
    } else {
      state.servers.unshift({ id: crypto.randomUUID(), name, host, port, note, enabled });
    }

    saveState();
    render();
    closeModal();
  });
}

function openProfileForm(existing){
  const isEdit = !!existing;
  const wrap = el("div");

  wrap.innerHTML = `
    <div class="grid">
      <div class="field">
        <label>Ù†Ø§Ù…</label>
        <input id="p_name" placeholder="Ù…Ø«Ù„Ø§Ù‹ Mobile" value="${escapeHtml(existing?.name || "")}">
      </div>

      <div class="field" style="grid-column:1/-1">
        <label>Ù…Ø­ØªÙˆØ§ (Ù‡Ø± Ù…ØªÙ†/Ù„ÛŒÙ†Ú© Ø¯Ù„Ø®ÙˆØ§Ù‡ â€” Ø¯Ø± sub.txt Ù‡Ø± Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÛŒÚ© Ø®Ø· Ù…ÛŒâ€ŒØ´ÙˆØ¯)</label>
        <textarea id="p_content" rows="4" placeholder="Ù‡Ø± Ú†ÛŒØ²ÛŒ...">${escapeHtml(existing?.content || "")}</textarea>
      </div>

      <div class="field" style="grid-column:1/-1">
        <label>ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</label>
        <input id="p_note" placeholder="Ø§Ø®ØªÛŒØ§Ø±ÛŒ" value="${escapeHtml(existing?.note || "")}">
      </div>

      <div class="field" style="grid-column:1/-1">
        <label>ÙØ¹Ø§Ù„</label>
        <input id="p_enabled" type="checkbox" ${(existing?.enabled ?? true) ? "checked" : ""}>
      </div>
    </div>
  `;

  openModal(isEdit ? "ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„" : "Ø§ÙØ²ÙˆØ¯Ù† Ù¾Ø±ÙˆÙØ§ÛŒÙ„", wrap, () => {
    const name = $("#p_name").value.trim();
    const content = $("#p_content").value.trim();
    const note = $("#p_note").value.trim();
    const enabled = $("#p_enabled").checked;

    if(!name || !content){
      alert("Ù†Ø§Ù… Ùˆ Ù…Ø­ØªÙˆØ§ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª.");
      return;
    }

    if(isEdit){
      existing.name = name;
      existing.content = content;
      existing.note = note;
      existing.enabled = enabled;
    } else {
      state.profiles.unshift({ id: crypto.randomUUID(), name, content, note, enabled });
    }

    saveState();
    render();
    closeModal();
  });
}

/* ===========================
   GitHub Publish (sub.txt)
=========================== */
async function ghUpsertFile({owner, repo, branch, path, token, content, commitMessage}){
  const safePath = encodeURIComponent(path).replaceAll("%2F","/");
  const apiBase = `https://api.github.com/repos/${owner}/${repo}/contents/${safePath}`;

  // check existing sha
  const getRes = await fetch(`${apiBase}?ref=${encodeURIComponent(branch)}`, {
    headers: { "Authorization": `Bearer ${token}`, "Accept": "application/vnd.github+json" }
  });

  let sha = null;
  if(getRes.status === 200){
    const data = await getRes.json();
    sha = data.sha;
  } else if(getRes.status === 404){
    sha = null;
  } else {
    const txt = await getRes.text();
    throw new Error(`GitHub GET failed: ${getRes.status} ${txt}`);
  }

  const body = {
    message: commitMessage,
    content: b64EncodeUtf8(content),
    branch
  };
  if(sha) body.sha = sha;

  const putRes = await fetch(apiBase, {
    method: "PUT",
    headers: {
      "Authorization": `Bearer ${token}`,
      "Accept": "application/vnd.github+json",
      "Content-Type": "application/json"
    },
    body: JSON.stringify(body)
  });

  if(!putRes.ok){
    const txt = await putRes.text();
    throw new Error(`GitHub PUT failed: ${putRes.status} ${txt}`);
  }
  return putRes.json();
}

/* ===========================
   Events
=========================== */
function bind(){
  // add buttons
  const btnAddServer = $("#btnAddServer");
  const btnAddProfile = $("#btnAddProfile");
  if (btnAddServer) btnAddServer.onclick = () => openServerForm(null);
  if (btnAddProfile) btnAddProfile.onclick = () => openProfileForm(null);

  // tabs (Ø§Ú¯Ø± ØªÙˆ HTML Ù‡Ù†ÙˆØ² Ù‡Ø³Øª)
  document.querySelectorAll(".tab").forEach(t => {
    t.onclick = () => {
      activeTab = t.dataset.tab;
      render();
    };
  });

  // downloads
  const btnDownloadSub = $("#btnDownloadSub");
  if (btnDownloadSub) btnDownloadSub.onclick = () => downloadText("sub.txt", buildSubTxt(), "text/plain");

  // export/import
  const btnExport = $("#btnExport");
  if (btnExport) btnExport.onclick = () => downloadText("panel-export.json", buildExportJson(), "application/json");

  const btnImport = $("#btnImport");
  const fileInput = $("#fileInput");
  if (btnImport && fileInput) btnImport.onclick = () => fileInput.click();

  // import handler: Ø¯Ùˆ Ù†ÙˆØ¹ ÙØ§ÛŒÙ„
  // 1) panel-export.json (Ø®Ø±ÙˆØ¬ÛŒ Ù‡Ù…ÛŒÙ† Ù¾Ù†Ù„)
  // 2) ÙØ§ÛŒÙ„ Ù…ØªÙ†ÛŒ sub.txt (Ù‡Ø± Ø®Ø· => ÛŒÚ© Ù¾Ø±ÙˆÙØ§ÛŒÙ„)
  if (fileInput){
    fileInput.addEventListener("change", async (e) => {
      const file = e.target.files?.[0];
      if(!file) return;

      try{
        const name = (file.name || "").toLowerCase();
        const txt = await file.text();

        if (name.endsWith(".txt")) {
          // sub.txt -> profiles
          const lines = txt.split(/\r?\n/).map(x => x.trim()).filter(Boolean);
          state.profiles = lines.map((line, i) => ({
            id: crypto.randomUUID(),
            name: `Imported-${i+1}`,
            content: line,
            note: "Imported from txt",
            enabled: true
          }));
        } else {
          // json -> state
          const data = JSON.parse(txt);
          state = {
            ...structuredClone(defaultState),
            ...data,
            github: { ...structuredClone(defaultState.github), ...(data.github || {}) },
            servers: Array.isArray(data.servers) ? data.servers : structuredClone(defaultState.servers),
            profiles: Array.isArray(data.profiles) ? data.profiles : structuredClone(defaultState.profiles),
          };
        }

        saveState();
        render();
        alert("ÙˆØ§Ø±Ø¯ Ø´Ø¯");
      } catch(err){
        console.error(err);
        alert("ÙØ§ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.");
      } finally {
        e.target.value = "";
      }
    });
  }

  // github inputs
  ["ghOwner","ghRepo","ghBranch","ghPathSub","ghToken"].forEach(id => {
    const inp = $("#"+id);
    if(!inp) return;
    inp.addEventListener("input", () => {
      state.github.owner = ($("#ghOwner")?.value || "").trim();
      state.github.repo = ($("#ghRepo")?.value || "").trim();
      state.github.branch = ($("#ghBranch")?.value || "main").trim() || "main";
      state.github.pathSub = ($("#ghPathSub")?.value || "sub.txt").trim() || "sub.txt";
      state.github.token = ($("#ghToken")?.value || "").trim();
      saveState();
    });
  });

  // show links
  const btnShowLinks = $("#btnShowLinks");
  const linksBox = $("#linksBox");
  if (btnShowLinks && linksBox){
    btnShowLinks.onclick = () => {
      if(!state.github.owner || !state.github.repo){
        alert("Owner Ùˆ Repo Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†.");
        return;
      }
      const link = buildRawSubLink();
      linksBox.classList.remove("hidden");
      linksBox.innerHTML = `
        <div class="muted">Ù„ÛŒÙ†Ú© Raw ÙØ§ÛŒÙ„ sub.txt:</div>
        <div style="margin-top:8px; user-select:all">
          <span class="badge">sub.txt</span>
          <div class="muted" style="margin-top:6px">${escapeHtml(link)}</div>
        </div>
      `;
    };
  }

  // publish
  const btnPublish = $("#btnPublish");
  const publishStatus = $("#publishStatus");

  if (btnPublish){
    btnPublish.onclick = async () => {
      if (!publishStatus) return;

      publishStatus.textContent = "";
      if (linksBox){ linksBox.classList.add("hidden"); linksBox.innerHTML = ""; }

      const { owner, repo, branch, pathSub, token } = state.github;

      if(!owner || !repo || !branch || !pathSub){
        alert("Owner / Repo / Branch / Path sub.txt Ø±Ø§ Ú©Ø§Ù…Ù„ Ú©Ù†.");
        return;
      }
      if(!token){
        alert("GitHub Token Ù„Ø§Ø²Ù… Ø§Ø³Øª (PAT).");
        return;
      }

      try{
        publishStatus.textContent = "Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªØ´Ø§Ø± Ø±ÙˆÛŒ GitHub...";

        await ghUpsertFile({
          owner, repo, branch,
          path: pathSub,
          token,
          content: buildSubTxt(),
          commitMessage: `Update ${pathSub}`
        });

        publishStatus.textContent = "âœ… Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯. sub.txt Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯.";

        if (linksBox){
          const link = buildRawSubLink();
          linksBox.classList.remove("hidden");
          linksBox.innerHTML = `
            <div class="muted">Ù„ÛŒÙ†Ú© Raw (Ù‡Ù…ÛŒØ´Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ù†Ø³Ø®Ù‡):</div>
            <div style="margin-top:8px; user-select:all">
              <span class="badge">sub.txt</span>
              <div class="muted" style="margin-top:6px">${escapeHtml(link)}</div>
            </div>
          `;
        }
      } catch(err){
        console.error(err);
        publishStatus.textContent = "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ù†ØªØ´Ø§Ø±. Token/Repo/Branch/Path Ø±Ø§ Ú†Ú© Ú©Ù†.";
        alert(String(err?.message || err));
      }
    };
  }
}

/* ===========================
   Start
=========================== */
window.addEventListener("DOMContentLoaded", () => {
  bind();
  render();
});
  </script>
</body>
</html>
